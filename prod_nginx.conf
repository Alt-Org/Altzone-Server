events { worker_connections 1024; }

http {
    include mime.types;

    server {
        listen 80;

        access_log off; #disable logs
        error_log syslog error;

        server_name altzone.fi;

        location / {
          proxy_pass http://altzone_api:8080;
        }

        gzip on;
        gzip_comp_level 3;
        gzip_types text/css text/javascript image/png image/webp image/x-jng image/gif image/jpeg;

        location ^~ /public {
            root /usr/local/nginx;

            add_header Cach-Control public;
            add_header Pragma public;
            add_header Vary Accept-Encoding;
            add_header Access-Control-Allow-Origin *;
            expires 1M;

            autoindex on;
            autoindex_format json;

            try_files $uri $uri/ =404;
        }

        location /game {
            root /usr/local/nginx;
            index index.html;

            # Specify MIME types for Brotli compression
            brotli on;
            brotli_static on;
            brotli_types text/plain text/css application/javascript application/json application/xml text/xml image/svg+xml;

            # Handling various file types
            include mime.types;
            default_type application/octet-stream;

            # Serve pre-compressed Brotli files with correct Content-Encoding header
            location ~* \.br$ {
                add_header Content-Encoding br;
                gzip off;
                brotli off; # Disable further on-the-fly Brotli compression

                # On-disk Brotli-precompressed JavaScript code files:
                location ~* \.js\.br$ {
                    default_type application/javascript;
                }

                # On-disk Brotli-precompressed WebAssembly files:
                location ~ \.wasm\.br$ {
                    default_type application/wasm;
                }

                try_files $uri =404;
            }

            try_files $uri $uri/ =404;
        }
    }
}